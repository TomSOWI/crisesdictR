---
title: "3. 1 Corona"
output: html_document
date: "2023-08-21"
---
### Corona

```{r}
corona <- c("Impfgegner", "Covid-19", "SARS-CoV-2", "Pandemie", "China-Virus", "Impfpflicht", "AstraZeneca", "Testzentrum", "Verschwörung(stheorien)", "Corona-Leugner", "Corona-Klage", "Maskenpflicht","Impfung")



aussortiert <- c("Meinungsfreiheit","impf*")


corona <- c("pandemie", "corona*", "covid-19","china-virus","corona-leugner","impfgegner","sars-cov-2", "lockdown","omikron","mrna","testzentr*")

            
unternehmen <-c("astrazeneca","biontech","pfizer", "johnson & johnson","moderna") #sinnvoll
```


```{r}
dfKwic <- as.data.frame(kwic(tokens_tolower(tokens(raw_corpus)),
           pattern = covdict, separator = " "))


dates <- data.frame(docname = docnames(raw_corpus), date = docvars(raw_corpus)$date)
dates$year <- as.numeric(substring(dates$date, 1,4))

dfMerged <- merge(dfKwic,dates)

dfunter2019 <- dfMerged[dfMerged$year < 2019,]
df2019 <- dfMerged[dfMerged$year >= 2019,]

table(dfunter2019$pattern)
table(df2019$pattern)


```

```{r}
covdict <- dictionary(list(corona = corona))

dfm <- dfm(raw_corpus)

results <- dfm%>%
  dfm_tolower()%>%
  dfm_lookup(covdict)

dfCorona <- convert(results, to = "data.frame")

#df$year <- as.numeric(substring(docvars(dfm)$date, 1,4))
#df$month <- paste0(substring(docvars(dfm)$date, 1,4),"-",substring(docvars(dfm)$date, 6,7), sep = "")
dfCorona$quarter <- floor_date(docvars(dfm)$date, "quarter")

results_quarter <- dfCorona %>%
  select(quarter, corona)%>%
  group_by(quarter)%>%
  reframe(
    corona = sum(corona)
  )

```


## Validierung

### Konstruktvalidität

```{r}
dfVal <- merge(results_quarter, dfGroup1)

cor(dfCor$corona, dfCor$Corona)
```
### Split-half reliabilität


### Wordclouds

```{r}
textplot <- function(text, min_freq = 25){
  text <- gsub("dass","",text)
  dtm <- dfm(text) %>%
    dfm(remove = stopwords('german')) %>%
    dfm_wordstem() %>%
    dfm_trim(min_termfreq = min_freq , verbose = FALSE)
  
  set.seed(100)
  textplot_wordcloud(dtm)
  
}
```

```{r}
dfKwic <- as.data.frame(kwic(toks,
           pattern = corona, separator = " "))


dfKwic$context <- paste0(dfKwic$pre," ", dfKwic$post)

textplot(dfKwic$context)
```
